module.exports = {
  name: "ماذا_لو",
  rank: 0,
  type: ["الالعاب", "النصوص"],
  description: "لعبة تخيلية تجمع شخصين في مواقف سودانية عشوائية (مضحكة ورومانسية)",
  usage: "طريقة الاستخدام: ماذا_لو الاسم1 - الاسم2",
  
  run: async (api, event, commands, args) => {
    // التحقق من وجود مدخلات
    if (args.length === 0) {
      return api.sendMessage(
        "يا زول، لازم تكتب اسمين! \nمثال: ماذا_لو أحمد - سارة",
        event.threadID,
        event.messageID
      );
    }

    const input = args.join(" ");
    let A, B;

    // منطق متطور لفصل الأسماء
    // يسمح بأسماء مركبة إذا تم استخدام الشرطة (-)
    if (input.includes("-")) {
      const splitInput = input.split("-").map(item => item.trim());
      A = splitInput[0];
      B = splitInput[1];
    } else {
      // إذا لم توجد شرطة، نأخذ أول كلمتين فقط
      A = args[0];
      B = args[1] || "شخص مجهول"; // حماية في حال نسيان الاسم الثاني
    }

    if (!A || !B) {
      return api.sendMessage(
        "الأسماء ما واضحة، عليك الله أكتبهم صح. \nمثال: ماذا_لو عمر - منى",
        event.threadID,
        event.messageID
      );
    }

    // قائمة النصوص باللهجة السودانية
    const prompts = [
      // رومانسي لطيف
      "{A} و {B} قاعدين يشربوا جبنة (قهوة) في العصارية، {A} سرح في عيون {B} وكب القهوة في توبه/قميصه بالغلط.",
      "{A} و {B} ماشين في شارع النيل، {A} اشترى غزل البنات لـ {B}، لكن الهواء طيره كله في وش {A}، و {B} مات/ت من الضحك.",
      "{A} عيان/ة ومسخن/ة، {B} عمل ليهو مديدة حلبة وقاعد جنبه يكمد ليهو ويقول ليهو 'كفارة وسلامتك يا غالي'.",
      "{B} فاجأ {A} بإنو حفظ تاريخ ميلاده، وجاب ليهو هدية بسيطة مغلفة بجريدة، {A} دمعت عيونه من الفرحة.",
      
      // مضحك ومواقف سودانية
      "{A} عزم {B} على عشاء فخيم، ولما جابو الفاتورة اكتشف انو ناسي محفظته في البيت، {B} هو الدفع الحساب وقعد يذل {A} بالموضوع دا شهر كامل.",
      "{A} و {B} ركبوا ركشة، وبتاع الركشة شغل أغاني زنق بصوت عالي، {A} قعد يرقص ويهجج في الركشة و {B} مدنقر راسه من الخجل.",
      "{A} اشترى باسطة ودسّاها في التلاجة، {B} قام بالليل أكلها كلها وعمل رايح، ولما {A} سأله، حلف قال دي الكديسة.",
      "{A} حاول يعمل فيها شيف ويطبخ لـ {B} ملاح بامية، لكن حرق الحلة والجيران شموا الريحة وجو يدقوا الباب يفتكروها حريقة.",
      "{B} لقى {A} بيتكلم مع نفسه قدام المراية وبيتخيل نفسه مذيع في تلفزيون السودان، قام {B} صوره فيديو وهدده ينشره في الفيسبوك.",
      
      // مواقف محرجة
      "{A} و {B} في عرس، {A} دخل الدارة يرقص واتزحلق وقع قدام الناس، {B} عمل نفسه ما بيعرفه وطلع برا الصالة.",
      "{A} مشى يخطب، وشال معاه {B} عشان يشجعه، قام {B} اتوتر وكب العصير في توب نسيبة {A} المستقبلية.",
      
      // أكشن وخيال
      "{A} و {B} لقوا نفسهم فجأة في نص السوق العربي والناس كلها بتجري، اكتشفوا انو في تخفيضات 90%، {A} رمى {B} وجرى عشان يلحق القميص.",
      "{A} و {B} قاعدين يحضروا فيلم رعب، {A} عامل فيها شجاع، أول ما النور قطع {A} صرخ صرخة صحت الحلة كلها و {B} بقى يهديه.",
      "{A} و {B} اتقفل عليهم باب المصعد، {A} بدأ يتشهد ويكتب وصيته، بينما {B} كان بياكل تسالي ببرود شديد.",
      
      // دراما خفيفة
      "{A} زعل من {B} وقرر ما يتكلم معاه، قام {B} جاب ليهو ساندوتش طعمية وشطة خضراء، {A} نسى الزعل طوالي وقعد ياكل.",
      "{A} بيحاول يعلم {B} سواقة العربية، {B} دخل بالعربية في عمود الكهرباء، و {A} نزل يجري وخلى العربية.",
      
      // سيناريوهات إضافية متنوعة
      "{A} و {B} سافروا بالباص للولاية، {A} نام وريل على كتف {B} طول الطريق، و {B} ما قادر يتحرك.",
      "{A} رسل رسالة بالغلط لـ {B} كان قاصد بيها زول تاني وفيها كلام شين، {B} رد ليهو بـ 'تمام يا أصلي الحساب ولد'.",
      "{B} قرر يعمل مقلب في {A} ولبس ملاية بيضاء بالليل، {A} خاف وضرب {B} بـ 'الشبشب' في نص جبهته.",
      "{A} و {B} قرروا يعملوا دايت، بعد ساعتين لقوا بعض بالدس بياكلوا شاورما في المحطة.",
      "{A} بقى يغني بصوت عالي في الحمام، {B} سجل الصوت وعملو نغمة رنين لتلفونه.",
      "{A} لقى {B} بيبكي، افتكره زعلان، طلع {B} بقطع بصل عشان الغداء.",
      "{A} و {B} ماشين في الشارع، فجأة كلب هوهو فيهم، {A} جرى وخلى {B} براهو يواجه المصير.",
      "{B} كان سرحان وب يعاين لـ {A} بإعجاب، فجأة {A} التفت وقال ليهو: 'مالك بتعاين لي كدا؟ فيني حاجة غلط؟' {B} اتلخبط وقال: 'لا بس في ذبابة في راسك'.",
      "{A} و {B} مشوا يشتروا خروف الضحية، الخروف نطح {A} وقعد يجري وراه، و {B} واقف يصور فيديو تيك توك."
    ];

    // اختيار نص عشوائي
    const randomIndex = Math.floor(Math.random() * prompts.length);
    let msg = prompts[randomIndex];

    // استبدال الرموز بالأسماء
    // استخدام تعبير منتظم لاستبدال كل تواجد لـ {A} و {B}
    msg = msg.replace(/{A}/g, A).replace(/{B}/g, B);

    // إرسال الرسالة
    api.sendMessage(msg, event.threadID, event.messageID);
  }
};

